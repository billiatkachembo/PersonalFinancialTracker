import{c as k,t as I,j as e}from"./index-Dyy1KlOR.js";import{r as g}from"./vendor-BgKluMRn.js";import{B as w}from"./button-DrwKho1A.js";import{I as j}from"./input-nRTx-HcG.js";import{L as u}from"./label-BuJPDLgL.js";import{T as F}from"./textarea-DLZJwJ4o.js";import{u as D,S as b,a as N,b as C,c as S,d as m,P as L}from"./Index-BH9e9aIM.js";import{u as T}from"./useLanguage-BX4Z74C8.js";import{C as O}from"./calculator-n0Lb3y7H.js";import"./Spinner-CHoRvTaw.js";const l=k("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),B=[{value:"salary",label:"Salary",icon:e.jsx(l,{className:"inline w-4 h-4 mr-1 text-muted-foreground"})},{value:"bonus",label:"Bonus",icon:e.jsx(l,{className:"inline w-4 h-4 mr-1 text-muted-foreground"})},{value:"business",label:"Business",icon:e.jsx(l,{className:"inline w-4 h-4 mr-1 text-muted-foreground"})},{value:"investment",label:"Investment",icon:e.jsx(l,{className:"inline w-4 h-4 mr-1 text-muted-foreground"})},{value:"rental",label:"Rental Income",icon:e.jsx(l,{className:"inline w-4 h-4 mr-1 text-muted-foreground"})},{value:"freelance",label:"Freelance",icon:e.jsx(l,{className:"inline w-4 h-4 mr-1 text-muted-foreground"})},{value:"gift",label:"Gift",icon:e.jsx(l,{className:"inline w-4 h-4 mr-1 text-muted-foreground"})},{value:"allowance",label:"Allowance",icon:e.jsx(l,{className:"inline w-4 h-4 mr-1 text-muted-foreground"})},{value:"refund",label:"Refund",icon:e.jsx(l,{className:"inline w-4 h-4 mr-1 text-muted-foreground"})},{value:"dividend",label:"Dividend",icon:e.jsx(l,{className:"inline w-4 h-4 mr-1 text-muted-foreground"})},{value:"other",label:"Other",icon:e.jsx(l,{className:"inline w-4 h-4 mr-1 text-muted-foreground"})},{value:"savings",label:"Savings",icon:e.jsx(l,{className:"inline w-4 h-4 mr-1 text-muted-foreground"})}],M=[{value:"one-time",label:"One-time"},{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"}],R=y=>{const s=y.replace(/[^0-9+\-*/().]/g,"");try{let t=0;const h=()=>{let n=c();for(;t<s.length;){const i=s[t];if(i==="+")t++,n+=c();else if(i==="-")t++,n-=c();else break}return n},c=()=>{let n=d();for(;t<s.length;){const i=s[t];if(i==="*")t++,n*=d();else if(i==="/"){t++;const f=d();if(f===0)throw new Error("Division by zero");n/=f}else break}return n},d=()=>{if(s[t]==="("){t++;const i=h();if(s[t]!==")")throw new Error("Missing closing parenthesis");return t++,i}let n="";for(;t<s.length&&(s[t]==="."||s[t]>="0"&&s[t]<="9");)n+=s[t],t++;if(n==="")throw new Error("Invalid expression");return parseFloat(n)},p=h();if(t!==s.length)throw new Error("Invalid expression");return p}catch{throw new Error("Invalid expression")}},J=({onSubmit:y})=>{const[s,t]=g.useState({date:new Date().toISOString().split("T")[0],amount:0,source:"",category:"",description:"",account:"Cash",repeat:"one-time",repeatStart:"",repeatEnd:""}),[h,c]=g.useState(!1),[d,p]=g.useState(""),{toast:n}=I();T();const{currencies:i,currency:f}=D(),o=(a,r)=>{t(x=>({...x,[a]:r}))},E=a=>{if(a.preventDefault(),!s.amount||!s.source||!s.description){n({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}if(s.amount<=0){n({title:"Error",description:"Amount must be greater than 0",variant:"destructive"});return}if(s.repeat!=="one-time"&&(!s.repeatStart||!s.repeatEnd)){n({title:"Error",description:"Please provide both repeat start and end dates",variant:"destructive"});return}y(s),t({date:new Date().toISOString().split("T")[0],amount:0,source:"",category:"",description:"",account:"Cash",repeat:"one-time",repeatStart:"",repeatEnd:""}),p(""),c(!1),n({title:"Success",description:"Income added successfully!",variant:"default"})},v=a=>{if(a==="=")try{const r=d||s.amount.toString(),x=R(r);if(isNaN(x))throw new Error("Invalid calculation");o("amount",parseFloat(x.toFixed(2))),p(""),c(!1)}catch{n({title:"Error",description:"Invalid calculation",variant:"destructive"})}else p(a==="C"?"":a==="DEL"?r=>r.slice(0,-1):r=>r+a)};return g.useEffect(()=>{if(!h)return;const a=r=>{r.key>="0"&&r.key<="9"||["+","-","*","/","."].includes(r.key)?v(r.key):r.key==="Enter"?v("="):r.key==="Escape"?c(!1):r.key.toLowerCase()==="c"?v("C"):r.key==="Backspace"&&v("DEL")};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[h,d]),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"income-date",children:"Date"}),e.jsx(j,{id:"income-date",type:"date",value:s.date,onChange:a=>o("date",a.target.value),className:"shadow-soft"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"income-amount",children:["Amount (",i[f].symbol,") *"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:"income-amount",type:"number",step:"0.01",min:"0",value:d||s.amount||"",onChange:a=>o("amount",parseFloat(a.target.value)),placeholder:"0.00",className:"shadow-soft flex-1"}),e.jsx(w,{type:"button",variant:"ghost",size:"sm",onClick:()=>c(!h),children:e.jsx(O,{className:"h-4 w-4 text-muted-foreground"})})]}),h&&e.jsxs("div",{className:"absolute top-16 right-0 w-64 p-2 rounded-lg shadow-md bg-background text-foreground z-50",children:[e.jsx("div",{className:"mb-2 text-right font-mono select-none border-b-2 pb-1 border-gray-200",children:d||s.amount||"0"}),e.jsx("div",{className:"grid grid-cols-5 gap-1",children:["7","8","9","+","4","5","6","-","1","2","3","*","0",".","=","/","C","DEL"].map(a=>e.jsx(w,{type:"button",variant:"outline",size:"sm",onClick:()=>v(a),children:a},a))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"income-source",children:"Source *"}),e.jsxs(b,{value:s.source,onValueChange:a=>o("source",a),required:!0,children:[e.jsx(N,{className:"shadow-soft",children:e.jsx(C,{placeholder:"Select income source"})}),e.jsx(S,{className:"space-y-2 p-2 max-h-[300px] overflow-auto",children:B.map(({value:a,label:r,icon:x})=>e.jsxs(m,{value:a,className:"flex items-center gap-2",children:[x," ",r]},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"income-account",children:"Account"}),e.jsxs(b,{value:s.account,onValueChange:a=>o("account",a),children:[e.jsx(N,{className:"shadow-soft",children:e.jsx(C,{placeholder:"Select account"})}),e.jsxs(S,{children:[e.jsx(m,{value:"Cash",children:"💵 Cash"}),e.jsx(m,{value:"Savings",children:"🏦 Savings"}),e.jsx(m,{value:"Bank",children:"🏦 Bank"}),e.jsx(m,{value:"Credit Card",children:"💳 Credit Card"}),e.jsx(m,{value:"Debit Card",children:"🏧 Debit Card"}),e.jsx(m,{value:"Mobile Money",children:"📱 Mobile Money"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"income-repeat",children:"Repeat"}),e.jsxs(b,{value:s.repeat,onValueChange:a=>o("repeat",a),children:[e.jsx(N,{className:"shadow-soft",children:e.jsx(C,{placeholder:"Repeat frequency"})}),e.jsx(S,{children:M.map(({value:a,label:r})=>e.jsx(m,{value:a,children:r},a))})]})]})]}),s.repeat!=="one-time"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"repeat-start",children:"Repeat Start *"}),e.jsx(j,{id:"repeat-start",type:"date",value:s.repeatStart,onChange:a=>o("repeatStart",a.target.value),className:"shadow-soft"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"repeat-end",children:"Repeat End *"}),e.jsx(j,{id:"repeat-end",type:"date",value:s.repeatEnd,onChange:a=>o("repeatEnd",a.target.value),className:"shadow-soft"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"income-description",children:"Description *"}),e.jsx(F,{id:"income-description",value:s.description,onChange:a=>o("description",a.target.value),placeholder:"Where is this income from?",className:"shadow-soft",rows:3})]}),e.jsxs(w,{type:"submit",variant:"income",className:"w-full",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Add Income"]})]})};export{J as IncomeForm};

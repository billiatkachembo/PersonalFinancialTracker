import{c as U,t as q,j as s}from"./index-CXfqqSNR.js";import{r as o}from"./vendor-BgKluMRn.js";import{u as O,a as b,c as N,d as k,e as S,b as E,C as I}from"./useLanguage-CzxK3kxw.js";import{B as n}from"./button-CH5IRsWw.js";import{I as c}from"./input-9izpb35h.js";import{T as V}from"./trash-2-N99csCay.js";const W=U("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),Z=({onUnlock:x})=>{const{toast:a}=q(),{t:e}=O(),[f,v]=o.useState(""),[j,p]=o.useState(""),[w,h]=o.useState(!1),[D,y]=o.useState(!1),[i,d]=o.useState(""),[r,l]=o.useState(""),[u,m]=o.useState(""),[A,H]=o.useState(!1),[R,P]=o.useState(!1);o.useEffect(()=>{h(localStorage.getItem("app-passcode")!==null),L()},[]);const L=async()=>{if(window.PublicKeyCredential)try{const t=await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();P(t)}catch{P(!1)}},C=()=>{const t=localStorage.getItem("app-passcode");if(!t){p(e("noPasscodeSet"));return}const g=atob(t);f===g?(sessionStorage.setItem("app-authenticated","true"),p(""),v(""),x()):p(e("incorrectPasscode"))},B=async()=>{try{await navigator.credentials.get({publicKey:{challenge:new Uint8Array(32),timeout:6e4,userVerification:"required"}})&&(a({title:e("biometricSuccess")}),x())}catch{a({title:e("biometricFailed"),variant:"destructive"})}},K=()=>{if(!r||r!==u){a({title:e("error"),description:e("passcodesDontMatchOrEmpty"),variant:"destructive"});return}if(r.length<4){a({title:e("error"),description:e("passcodeMinLength"),variant:"destructive"});return}localStorage.setItem("app-passcode",btoa(r)),h(!0),l(""),m(""),a({title:e("passcodeEnabled"),description:e("passcodeEnabledDescription")})},F=()=>{const t=localStorage.getItem("app-passcode");if(!t)return;const g=atob(t);if(i!==g){a({title:e("error"),description:e("currentPasscodeIncorrect"),variant:"destructive"});return}if(!r||r!==u){a({title:e("error"),description:e("newPasscodesDontMatchOrEmpty"),variant:"destructive"});return}if(r.length<4){a({title:e("error"),description:e("passcodeMinLength"),variant:"destructive"});return}localStorage.setItem("app-passcode",btoa(r)),d(""),l(""),m(""),y(!1),a({title:e("passcodeChanged"),description:e("passcodeChangedDescription")})},M=()=>{if(!i||atob(localStorage.getItem("app-passcode")||"")!==i){a({title:e("error"),description:e("currentPasscodeIncorrect"),variant:"destructive"});return}localStorage.removeItem("app-passcode"),sessionStorage.removeItem("app-authenticated"),h(!1),d(""),a({title:e("passcodeDisabled"),description:e("passcodeDisabledDescription")})},T=sessionStorage.getItem("app-authenticated");return w&&!T?s.jsxs(b,{className:"max-w-sm mx-auto mt-6",children:[s.jsxs(N,{children:[s.jsx(k,{children:e("unlockApp")}),s.jsx(S,{children:e("enterPasscodeToContinue")})]}),s.jsxs(E,{className:"space-y-4",children:[s.jsx(c,{type:A?"text":"password",placeholder:e("enterPasscode")||"Enter your 4-digit passcode",value:f,onChange:t=>v(t.target.value),onKeyDown:t=>t.key==="Enter"&&C(),autoFocus:!0,className:"text-foreground"}),j&&s.jsx("p",{className:"text-destructive",children:j}),s.jsxs("div",{className:"flex flex-col space-y-2",children:[s.jsx(n,{className:"bg-green-600 text-white hover:bg-green-700",onClick:C,children:e("unlock")}),s.jsx(n,{variant:"outline",onClick:B,className:"text-sm font-medium text-muted-foreground dark:text-muted flex items-center justify-center",children:e("unlockWithBiometrics")})]})]})]}):s.jsxs(b,{className:"max-w-md mx-auto mt-6",children:[s.jsxs(N,{children:[s.jsx(k,{className:"text-foreground",children:e("passcodeSettings")}),s.jsx(S,{className:"text-muted-foreground",children:e("secureAppWithPasscode")})]}),s.jsx(E,{className:"space-y-4",children:w?D?s.jsxs(s.Fragment,{children:[s.jsx(c,{type:"password",placeholder:e("currentPasscode")||"Enter current passcode",value:i,onChange:t=>d(t.target.value),className:"text-foreground"}),s.jsx(c,{type:"password",placeholder:e("newPasscode")||"Enter new 4-digit passcode",value:r,onChange:t=>l(t.target.value),className:"text-foreground",minLength:4}),s.jsx(c,{type:"password",placeholder:e("confirmPasscode")||"Confirm new passcode",value:u,onChange:t=>m(t.target.value),className:"text-foreground",minLength:4}),s.jsxs(n,{className:"w-full",onClick:F,children:[s.jsx(I,{className:"mr-2 w-4 h-4"}),e("saveChanges")]})]}):s.jsxs(s.Fragment,{children:[s.jsx(c,{type:"password",placeholder:e("currentPasscode")||"Enter current passcode",value:i,onChange:t=>d(t.target.value),className:"text-foreground"}),s.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[s.jsxs(n,{variant:"default",onClick:()=>y(!0),className:"text-sm font-medium text-muted-foreground dark:text-muted flex items-center justify-center",children:[s.jsx(W,{className:"mr-2 w-4 h-4"}),e("changePasscode")]}),s.jsxs(n,{variant:"destructive",onClick:()=>{window.confirm(e("confirmDisablePasscode"))&&M()},className:"text-destructive-foreground flex items-center justify-center",children:[s.jsx(V,{className:"mr-2 w-4 h-4"}),e("disablePasscode")]})]})]}):s.jsxs(s.Fragment,{children:[s.jsx(c,{type:"password",placeholder:e("newPasscode")||"Enter new 4-digit passcode",value:r,onChange:t=>l(t.target.value),className:"text-foreground",minLength:4}),s.jsx(c,{type:"password",placeholder:e("confirmPasscode")||"Confirm new passcode",value:u,onChange:t=>m(t.target.value),className:"text-foreground",minLength:4}),s.jsxs(n,{className:"w-full",onClick:K,children:[s.jsx(I,{className:"mr-2 w-4 h-4"}),e("enablePasscode")]})]})})]})};export{Z as PasscodeManager};

import{c as j,j as e,a as G,b as re,t as Y}from"./index-Dyy1KlOR.js";import{r as l}from"./vendor-BgKluMRn.js";import{B as k}from"./button-DrwKho1A.js";import{u as K,a as D,c as O,d as F,e as A,b as C}from"./useLanguage-BX4Z74C8.js";import{PasscodeManager as ne}from"./PasscodeManager-BpRD-kcB.js";const ce=j("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const le=j("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);const pe=j("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);const de=j("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);const ue=j("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);const ge=j("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);const me=j("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),fe=re("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),q=l.forwardRef(({className:v,variant:p,...u},h)=>e.jsx("div",{ref:h,role:"alert",className:G(fe({variant:p}),v),...u}));q.displayName="Alert";const he=l.forwardRef(({className:v,...p},u)=>e.jsx("h5",{ref:u,className:G("mb-1 font-medium leading-none tracking-tight",v),...p}));he.displayName="AlertTitle";const z=l.forwardRef(({className:v,...p},u)=>e.jsx("div",{ref:u,className:G("text-sm [&_p]:leading-relaxed",v),...p}));z.displayName="AlertDescription";const xe="YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com",H="YOUR_GOOGLE_API_KEY",ye="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.readonly",Se=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],ve="picker",Ie=({autoExport:v,userEmail:p})=>{const[u,h]=l.useState(!1),[x,b]=l.useState(!1),[P,W]=l.useState(!1),[Q,Z]=l.useState(!1),[J,L]=l.useState(!1),[$,_]=l.useState([]),{t}=K(),{toast:r}=Y(),U=l.useRef(!1),E=l.useRef(null);l.useEffect(()=>{const s=document.createElement("script");s.src="https://apis.google.com/js/api.js",s.async=!0,s.onload=()=>{window.gapi.load("client:auth2",d),window.gapi.load(ve,()=>Z(!0))},document.body.appendChild(s);function d(){window.gapi.client.init({apiKey:H,clientId:xe,discoveryDocs:Se,scope:ye}).then(()=>{W(!0);const i=window.gapi.auth2.getAuthInstance();L(i.isSignedIn.get()),i.isSignedIn.listen(n=>{L(n),n?(E.current=i.currentUser.get().getAuthResponse().access_token,B()):(E.current=null,_([]))}),i.isSignedIn.get()&&(E.current=i.currentUser.get().getAuthResponse().access_token,B())}).catch(i=>{console.error("Google API init error",i),r({title:"Google API Initialization Failed",description:"Failed to load Google Drive integration.",variant:"destructive"})})}},[r]);const X=()=>{P&&window.gapi.auth2.getAuthInstance().signIn()},ee=()=>{P&&window.gapi.auth2.getAuthInstance().signOut()},B=()=>{P&&window.gapi.client.drive.files.list({pageSize:10,fields:"files(id, name, createdTime)",q:"mimeType='application/json' and name contains 'finance-backup'",orderBy:"createdTime desc"}).then(s=>{_(s.result.files||[])}).catch(s=>{r({title:t("error")||"Error",description:t("failedToListBackups")||"Failed to list backup files from Google Drive.",variant:"destructive"}),console.error(s)})},te=()=>{if(!P){r({title:t("googleApiNotReady")||"Google API Not Ready",description:t("tryAgainLater")||"Please try again later.",variant:"destructive"});return}h(!0);try{const s=JSON.parse(localStorage.getItem("expenses")||"[]"),d=JSON.parse(localStorage.getItem("income")||"[]"),i=JSON.parse(localStorage.getItem("finance-notes")||"[]"),n=JSON.parse(localStorage.getItem("passcodes")||"[]"),o=localStorage.getItem("profile-pic")||null,y=localStorage.getItem("profile-name")||"",g=localStorage.getItem("profile-email")||"",a={language:localStorage.getItem("language"),currency:localStorage.getItem("currency"),theme:localStorage.getItem("vite-ui-theme")},S={expenses:s,income:d,notes:i,passcodes:n,profile:{profilePic:o,profileName:y,profileEmail:g},settings:a,exportDate:new Date().toISOString(),version:"1.0",userEmail:p},m="-------314159265358979323846",f=`\r
--${m}\r
`,w=`\r
--${m}--`,I={name:`finance-backup-${new Date().toISOString().split("T")[0]}.json`,mimeType:"application/json"},R=f+`Content-Type: application/json\r
\r
`+JSON.stringify(I)+f+`Content-Type: application/json\r
\r
`+JSON.stringify(S)+w;window.gapi.client.request({path:"/upload/drive/v3/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":`multipart/related; boundary="${m}"`},body:R}).then(()=>{r({title:t("exportSuccessful")||"Export Successful",description:t("exportSuccessDesc")||"Backup uploaded to Google Drive successfully."}),h(!1),B(),U.current=!0},N=>{r({title:t("exportFailed")||"Export Failed",description:t("exportFailedDesc")||"Failed to upload backup to Google Drive.",variant:"destructive"}),h(!1),console.error("Google Drive upload error",N)})}catch(s){r({title:t("exportFailed")||"Export Failed",description:t("exportFailedDesc")||"Failed to prepare backup data.",variant:"destructive"}),h(!1),console.error(s)}},M=(s,d)=>{b(!0),window.gapi.client.drive.files.get({fileId:s,alt:"media"}).then(i=>{const n=i.body||JSON.stringify(i.result),o=JSON.parse(n);if(o.expenses&&localStorage.setItem("expenses",JSON.stringify(o.expenses)),o.income&&localStorage.setItem("income",JSON.stringify(o.income)),o.notes&&localStorage.setItem("finance-notes",JSON.stringify(o.notes)),o.passcodes&&localStorage.setItem("passcodes",JSON.stringify(o.passcodes)),o.profile){const{profilePic:y,profileName:g,profileEmail:a}=o.profile;y&&localStorage.setItem("profile-pic",y),g&&localStorage.setItem("profile-name",g),a&&localStorage.setItem("profile-email",a)}o.settings&&(o.settings.language&&localStorage.setItem("language",o.settings.language),o.settings.currency&&localStorage.setItem("currency",o.settings.currency),o.settings.theme&&localStorage.setItem("vite-ui-theme",o.settings.theme)),r({title:t("importSuccessful")||"Import Successful",description:t("importSuccessDesc")||`Backup "${d}" imported successfully. Please refresh the page.`})}).catch(i=>{r({title:t("importFailed")||"Import Failed",description:t("importFailedDesc")||"Failed to download or import backup from Google Drive.",variant:"destructive"}),console.error(i)}).finally(()=>{b(!1)})},se=()=>{if(!Q||!E.current){r({title:t("pickerNotReady")||"Picker Not Ready",description:t("signInFirst")||"Please sign in to Google Drive first.",variant:"destructive"});return}const s=new window.google.picker.DocsView(window.google.picker.ViewId.DOCS);s.setMimeTypes("application/json"),s.setSelectFolderEnabled(!1),s.setIncludeFolders(!1),s.setQuery("finance-backup"),new window.google.picker.PickerBuilder().addView(s).setOAuthToken(E.current).setDeveloperKey(H).setCallback(i=>{if(i.action===window.google.picker.Action.PICKED){const n=i.docs[0];n&&n.id&&M(n.id,n.name)}}).build().setVisible(!0)},ae=()=>{if(!u){h(!0);try{const s=JSON.parse(localStorage.getItem("expenses")||"[]"),d=JSON.parse(localStorage.getItem("income")||"[]"),i=JSON.parse(localStorage.getItem("finance-notes")||"[]"),n=JSON.parse(localStorage.getItem("passcodes")||"[]"),o=localStorage.getItem("profile-pic")||null,y=localStorage.getItem("profile-name")||"",g=localStorage.getItem("profile-email")||"",a={language:localStorage.getItem("language"),currency:localStorage.getItem("currency"),theme:localStorage.getItem("vite-ui-theme")},S=["Type,Date,Amount,Category,Description,Account",...s.map(c=>`Expense,${c.date},${c.amount},${c.category},"${c.description}",${c.account||""}`),...d.map(c=>`Income,${c.date},${c.amount},${c.category},"${c.description}",${c.account||""}`)].join(`
`),m={expenses:s,income:d,notes:i,passcodes:n,profile:{profilePic:o,profileName:y,profileEmail:g},settings:a,exportDate:new Date().toISOString(),version:"1.0",userEmail:p},f=new Blob([S],{type:"text/csv"}),w=window.URL.createObjectURL(f),I=document.createElement("a");I.href=w,I.download=`finance-backup-${new Date().toISOString().split("T")[0]}.csv`,I.click(),window.URL.revokeObjectURL(w);const R=new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),N=window.URL.createObjectURL(R),T=document.createElement("a");T.href=N,T.download=`finance-backup-${new Date().toISOString().split("T")[0]}.json`,T.click(),window.URL.revokeObjectURL(N),r({title:t("exportSuccessful")||"Export Successful",description:t("exportSuccessDesc")||"Your data has been exported successfully."}),U.current=!0}catch{r({title:t("exportFailed")||"Export Failed",description:t("exportFailedDesc")||"Failed to export data. Please try again.",variant:"destructive"})}finally{h(!1)}}},oe=s=>{var n;const d=(n=s.target.files)==null?void 0:n[0];if(!d)return;b(!0);const i=new FileReader;i.onload=o=>{var y;try{const g=(y=o.target)==null?void 0:y.result;if(d.name.endsWith(".json")){const a=JSON.parse(g);if(a.expenses&&localStorage.setItem("expenses",JSON.stringify(a.expenses)),a.income&&localStorage.setItem("income",JSON.stringify(a.income)),a.notes&&localStorage.setItem("finance-notes",JSON.stringify(a.notes)),a.passcodes&&localStorage.setItem("passcodes",JSON.stringify(a.passcodes)),a.profile){const{profilePic:S,profileName:m,profileEmail:f}=a.profile;S&&localStorage.setItem("profile-pic",S),m&&localStorage.setItem("profile-name",m),f&&localStorage.setItem("profile-email",f)}a.settings&&(a.settings.language&&localStorage.setItem("language",a.settings.language),a.settings.currency&&localStorage.setItem("currency",a.settings.currency),a.settings.theme&&localStorage.setItem("vite-ui-theme",a.settings.theme)),r({title:t("importSuccessful")||"Import Successful",description:t("importSuccessDesc")||"Your data has been imported successfully. Please refresh the page."})}else if(d.name.endsWith(".csv")){const a=g.split(`
`),S=[],m=[];for(let f=1;f<a.length;f++){const w=a[f].trim();if(!w)continue;const[I,R,N,T,c,ie]=w.split(","),V={date:R,amount:parseFloat(N),category:T,description:(c==null?void 0:c.replace(/(^"|"$)/g,""))||"",account:ie||""};I==="Expense"?S.push(V):I==="Income"&&m.push(V)}localStorage.setItem("expenses",JSON.stringify(S)),localStorage.setItem("income",JSON.stringify(m)),r({title:t("importSuccessful")||"Import Successful",description:t("importSuccessDesc")||"Your CSV data has been imported successfully. Please refresh the page."})}else r({title:t("importFailed")||"Import Failed",description:t("unsupportedFileFormat")||"Unsupported file format.",variant:"destructive"})}catch(g){r({title:t("importFailed")||"Import Failed",description:t("importFailedDesc")||"Failed to import data. Please check the file and try again.",variant:"destructive"}),console.error(g)}finally{b(!1)}},i.readAsText(d)};return e.jsx("div",{className:"space-y-6",children:e.jsxs(D,{className:"shadow-soft",children:[e.jsxs(O,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5"}),t("backupData")||"Backup Data"]}),e.jsx(A,{children:t("backupDataDescription")||"Export and import your financial data"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs(q,{children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(z,{children:t("backupWarning")||"Backup includes all your transactions, notes, passcodes, profile info, and settings. Keep your backups secure."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(D,{children:[e.jsxs(O,{children:[e.jsx(F,{className:"text-lg",children:t("exportData")||"Export Data"}),e.jsx(A,{children:t("exportDataDescription")||"Download your data as CSV or JSON file"})]}),e.jsxs(C,{children:[e.jsxs(k,{onClick:ae,disabled:u,className:"w-full mb-2",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),u?t("exporting")||"Exporting...":t("exportToFile")||"Export to CSV & JSON"]}),e.jsxs(k,{onClick:te,disabled:u,className:"w-full mb-2",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),u?t("exporting")||"Exporting...":t("backupToGoogleDrive")||"Backup to Google Drive"]}),J&&e.jsx(k,{onClick:ee,variant:"ghost",className:"w-full mb-4",children:t("signOutFromGoogle")||"Sign Out from Google"}),!J&&e.jsx(k,{onClick:X,variant:"outline",className:"w-full mb-4",children:t("signInToGoogleDrive")||"Sign In to Google Drive"})]})]}),e.jsxs(D,{children:[e.jsxs(O,{children:[e.jsx(F,{className:"text-lg",children:t("importData")||"Import Data"}),e.jsx(A,{children:t("importDataDescription")||"Import data from CSV or JSON file or Google Drive"})]}),e.jsxs(C,{children:[e.jsx("input",{type:"file",accept:".csv,.json",id:"fileInput",onChange:oe,disabled:x,className:"hidden"}),e.jsx("label",{htmlFor:"fileInput",className:"cursor-pointer block w-full mb-2",children:e.jsxs(k,{className:"w-full",disabled:x,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),x?t("importing")||"Importing...":t("importFromFile")||"Import from File"]})}),e.jsxs(k,{onClick:se,disabled:!J||x,variant:"outline",className:"w-full",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),t("restoreFromDrivePicker")||"Restore from Google Drive Picker"]})]})]})]}),$.length>0&&e.jsx("div",{className:"mt-6",children:e.jsxs(D,{children:[e.jsxs(O,{children:[e.jsx(F,{children:t("backupsOnDrive")||"Backups on Google Drive"}),e.jsx(A,{children:t("selectBackupToRestore")||"Select a backup file to restore your data"})]}),e.jsx(C,{children:e.jsx("ul",{className:"space-y-2 max-h-48 overflow-auto",children:$.map(s=>e.jsxs("li",{className:"flex justify-between items-center border rounded p-2 hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{children:s.name}),e.jsxs(k,{size:"sm",onClick:()=>M(s.id,s.name),disabled:x,children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),t("restore")||"Restore"]})]},s.id))})})]})})]})]})})},ke=l.createContext({theme:"light",toggleTheme:()=>{}}),we=()=>l.useContext(ke),je=({onUnlock:v})=>{Y();const{t:p}=K(),{theme:u,toggleTheme:h}=we(),[x,b]=l.useState(!1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(D,{children:[e.jsxs(O,{children:[e.jsx(F,{children:p("settings")}),e.jsx(A,{children:p("manageAppSecuritySettings")})]}),e.jsx(C,{className:"space-y-4",children:e.jsx(ne,{onUnlock:v})})]}),e.jsx("div",{className:"w-full max-w-sm space-y-3 mt-6"}),e.jsxs(D,{children:[e.jsx(O,{children:e.jsx(F,{children:p("backupAndRestore")})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs(k,{className:"flex items-center gap-4",onClick:()=>b(!x),children:["Backup and Restore Manager",p(x?"hideBackupManager":"openBackupManager")]}),x&&e.jsx(Ie,{})]})]})]})},Ce=Object.freeze(Object.defineProperty({__proto__:null,default:je},Symbol.toStringTag,{value:"Module"}));export{Ie as B,je as S,Ce as a};

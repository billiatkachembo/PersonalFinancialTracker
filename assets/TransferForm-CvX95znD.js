import{t as Q,j as t}from"./index-Dyy1KlOR.js";import{c as N,r as I}from"./vendor-BgKluMRn.js";import{B as O}from"./button-DrwKho1A.js";import{I as w}from"./input-nRTx-HcG.js";import{L as f}from"./label-BuJPDLgL.js";import{T as U}from"./textarea-DLZJwJ4o.js";import{u as X,S as T,a as k,b as A,c as F,d as M,R as Z}from"./Index-BH9e9aIM.js";import{u as _}from"./useLanguage-BX4Z74C8.js";import{C as ee}from"./calculator-n0Lb3y7H.js";import"./Spinner-CHoRvTaw.js";const L=l=>{let a;const n=new Set,o=(m,h)=>{const i=typeof m=="function"?m(a):m;if(!Object.is(i,a)){const b=a;a=h??(typeof i!="object"||i===null)?i:Object.assign({},a,i),n.forEach(j=>j(a,b))}},d=()=>a,v={setState:o,getState:d,getInitialState:()=>p,subscribe:m=>(n.add(m),()=>n.delete(m))},p=a=l(o,d,v);return v},te=l=>l?L(l):L,ae=l=>l;function se(l,a=ae){const n=N.useSyncExternalStore(l.subscribe,N.useCallback(()=>a(l.getState()),[l,a]),N.useCallback(()=>a(l.getInitialState()),[l,a]));return N.useDebugValue(n),n}const B=l=>{const a=te(l),n=o=>se(a,o);return Object.assign(n,a),n},ne=l=>l?B(l):B,re=ne((l,a)=>({transfers:JSON.parse(localStorage.getItem("transfers")||"[]"),addTransfer:n=>{const o=[...a().transfers];if(o.push(n),n.repeat&&n.repeatStart&&n.repeatEnd){const d=new Date(n.repeatStart),x=new Date(n.repeatEnd);let s=new Date(d);const v=()=>{switch(n.repeat){case"Daily":s.setDate(s.getDate()+1);break;case"Weekly":s.setDate(s.getDate()+7);break;case"Monthly":s.setMonth(s.getMonth()+1);break;case"Yearly":s.setFullYear(s.getFullYear()+1);break}};for(;s<=x;){const p=s.toISOString().split("T")[0];p!==n.date&&o.push({...n,date:p}),v()}}l({transfers:o}),localStorage.setItem("transfers",JSON.stringify(o))},deleteTransfer:n=>{const o=[...a().transfers];o.splice(n,1),l({transfers:o}),localStorage.setItem("transfers",JSON.stringify(o))}})),ve=({onSubmit:l})=>{var Y;const{t:a}=_(),{currencies:n,currency:o}=X(),{toast:d}=Q(),x=re(e=>e.addTransfer),[s,v]=I.useState({date:new Date().toISOString().split("T")[0],amount:0,fromAccount:"",toAccount:"",description:"",repeat:"One-time",repeatStart:"",repeatEnd:""}),[p,m]=I.useState(!1),[h,i]=I.useState(""),b=[{value:"Cash",label:"Cash",icon:"💵"},{value:"Bank",label:"Bank",icon:"🏦"},{value:"Credit Card",label:"Credit Card",icon:"💳"},{value:"Debit Card",label:"Debit Card",icon:"🏧"},{value:"Mobile Money",label:"Mobile Money",icon:"📱"}],j=[{value:"One-time",label:"One-time"},{value:"Daily",label:"Daily"},{value:"Weekly",label:"Weekly"},{value:"Monthly",label:"Monthly"},{value:"Yearly",label:"Yearly"}],u=(e,c)=>{v(r=>({...r,[e]:c}))},V=(e,c)=>{const r=new Date(e);switch(c){case"Daily":r.setDate(r.getDate()+1);break;case"Weekly":r.setDate(r.getDate()+7);break;case"Monthly":r.setMonth(r.getMonth()+1);break;case"Yearly":r.setFullYear(r.getFullYear()+1);break}return r},W=e=>{const c=h.slice(-1),r=["+","-","*","/"];r.includes(e)&&r.includes(c)||e==="."&&h.includes(".")&&(h.split(/[-+*/]/).pop()||"").includes(".")||i(g=>g+e)},z=()=>{try{const e=new Function("return "+h)(),c=parseFloat(e.toFixed(2));u("amount",c),i(""),m(!1)}catch{d({title:a("Error"),description:a("Invalid calculation")||"Invalid calculation",variant:"destructive"}),i("")}},J=()=>{i(""),u("amount",0)},q=()=>{i(e=>e.slice(0,-1))},P=e=>{const c=e.target.value;i(c),u("amount",parseFloat(c))},$=e=>{e.preventDefault();const{amount:c,fromAccount:r,toAccount:g,description:E,repeat:S,repeatStart:y,repeatEnd:C,date:H}=s;if(!c||!r||!g||!E){d({title:a("Error"),description:a("Please fill in all required fields"),variant:"destructive"});return}if(c<=0){d({title:a("Error"),description:a("Amount must be greater than 0"),variant:"destructive"});return}if(r===g){d({title:a("Error"),description:a("Cannot transfer to the same account"),variant:"destructive"});return}if(S!=="One-time"){if(!y||!C){d({title:a("Error"),description:a("Please select repeat start and end dates"),variant:"destructive"});return}if(C<y){d({title:a("Error"),description:a("Repeat end date cannot be before start date"),variant:"destructive"});return}let D=new Date(y);const K=new Date(C);for(;D<=K;)x({date:D.toISOString().split("T")[0],amount:c,fromAccount:r,toAccount:g,description:E,repeat:S,repeatStart:y,repeatEnd:C}),D=V(D,S)}else x({date:H,amount:c,fromAccount:r,toAccount:g,description:E,repeat:S});v({date:new Date().toISOString().split("T")[0],amount:0,fromAccount:"",toAccount:"",description:"",repeat:"One-time",repeatStart:"",repeatEnd:""}),i(""),d({title:a("Success"),description:a("Transfer successful!"),variant:"default"}),l(s)},R=e=>{const c=b.find(r=>r.value===e);return c?`${c.icon} ${c.label}`:a("Select account")},G=e=>{const c=j.find(r=>r.value===e);return c?c.label:a("Repeat frequency")};return t.jsxs("form",{onSubmit:$,className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{children:a("Date")}),t.jsx(w,{type:"date",value:s.date,onChange:e=>u("date",e.target.value),className:"shadow-soft"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(f,{children:[a("Amount")," (",(Y=n[o])==null?void 0:Y.symbol,") *"]}),t.jsxs("div",{className:"flex relative",children:[t.jsx(w,{type:"text",value:h||(s.amount>0?s.amount:""),onChange:P,placeholder:"0.00",className:"shadow-soft pr-10 flex-1"}),t.jsx(O,{type:"button",variant:"ghost",size:"sm",onClick:()=>{m(!p),!p&&s.amount>0?i(s.amount.toString()):!p&&s.amount===0&&i("")},className:"absolute right-0 top-1/2 -translate-y-1/2",children:t.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})})]}),p&&t.jsxs("div",{className:"inline top-16 right-10 w-64 p-2 rounded-lg shadow-md bg-background text-foreground z-50",children:[t.jsx("div",{className:"mb-2 text-right font-mono select-One-time border-b-2 pb-1 border-gray-200",children:h||s.amount||"0"}),t.jsx("div",{className:"grid grid-cols-4 gap-1",children:["7","8","9","/","4","5","6","*","1","2","3","-","C","0","DEL","+",".","="].map(e=>t.jsx(O,{type:"button",variant:"outline",size:"sm",onClick:()=>{e==="="?z():e==="C"?J():e==="DEL"?q():W(e)},children:e},e))})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{children:"Transfer From Account"}),t.jsxs(T,{value:s.fromAccount,onValueChange:e=>u("fromAccount",e),children:[t.jsx(k,{className:"shadow-soft",children:t.jsx(A,{placeholder:"Select Account",children:R(s.fromAccount)})}),t.jsx(F,{children:b.map(e=>t.jsxs(M,{value:e.value,children:[e.icon," ",e.label]},e.value))})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{children:"Transfer To Account"}),t.jsxs(T,{value:s.toAccount,onValueChange:e=>u("toAccount",e),children:[t.jsx(k,{className:"shadow-soft",children:t.jsx(A,{placeholder:"Select Account",children:R(s.toAccount)})}),t.jsx(F,{children:b.map(e=>t.jsxs(M,{value:e.value,children:[e.icon," ",e.label]},e.value))})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{children:"Repeat"}),t.jsxs(T,{value:s.repeat,onValueChange:e=>u("repeat",e),children:[t.jsx(k,{className:"shadow-soft",children:t.jsx(A,{children:G(s.repeat)})}),t.jsx(F,{children:j.map(e=>t.jsx(M,{value:e.value,children:e.label},e.value))})]})]}),s.repeat!=="One-time"&&t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{children:"Repeat Start"}),t.jsx(w,{type:"date",value:s.repeatStart,onChange:e=>u("repeatStart",e.target.value),className:"shadow-soft"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{children:"Repeat End"}),t.jsx(w,{type:"date",value:s.repeatEnd,onChange:e=>u("repeatEnd",e.target.value),className:"shadow-soft"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{children:"Description"}),t.jsx(U,{value:s.description,onChange:e=>u("description",e.target.value),placeholder:"Reason for transfer",className:"shadow-soft",rows:3})]}),t.jsxs(O,{type:"submit",variant:"default",className:"w-full",children:[t.jsx(Z,{className:"h-4 w-4 mr-2"}),"Transfer Funds"]})]})};export{ve as TransferForm};

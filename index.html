<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <!-- Content Security Policy (CSP) -->
    <meta http-equiv="Content-Security-Policy" content="
      default-src 'self';
      script-src 'self' 'unsafe-inline';
      style-src 'self' 'unsafe-inline';
      img-src 'self' data: blob:;
      connect-src 'self';
      font-src 'self';
      object-src 'none';
      base-uri 'self';
      form-action 'self';
      worker-src 'self' blob:;
    ">

    <!-- PWA + Icons -->
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="icon" href="favicon.ico" />

    <title>Money Manager</title>
    <meta name="description" content="Personal Financial Tracker by Billiat Kachembo" />
    <meta name="author" content="Billiat Kachembo" />
    <meta property="og:title" content="Money Manager" />
    <meta property="og:description" content="Track your personal finances with this easy-to-use application" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://billiatkachembo.github.io/PersonalFinancialTracker/" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="theme-color" content="#2F855A" />
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <style>
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        background: linear-gradient(135deg, #2F855A 0%, #1e5c3d 100%);
        color: white;
        min-height: 100vh;
      }
      .loading-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        gap: 1rem;
        text-align: center;
        padding: 2rem;
      }
      .loading-spinner {
        width: 48px;
        height: 48px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      .loading-text {
        font-size: 1.25rem;
        font-weight: 500;
      }
      .loading-subtext {
        opacity: 0.8;
        margin-top: 0.5rem;
      }
    </style>
  </head>

  <body>
    <div id="root">
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">Money Manager</div>
        <div class="loading-subtext">Loading your financial tracker...</div>
      </div>
    </div>

    <script>
      // App load flag
      window.__APP_LOADED__ = false;

      // Fallback if loading fails
      window.addEventListener('load', function() {
        setTimeout(function() {
          if (!window.__APP_LOADED__) {
            const root = document.getElementById('root');
            if (root) {
              root.innerHTML = `
                <div class="loading-container">
                  <h2>Loading Taking Too Long</h2>
                  <p>The application is taking longer than expected to load.</p>
                  <p>This might be due to Content Security Policy restrictions.</p>
                  <button onclick="window.location.reload()" style="
                    background: white;
                    color: #2F855A;
                    border: none;
                    padding: 0.75rem 1.5rem;
                    border-radius: 0.5rem;
                    cursor: pointer;
                    font-weight: 600;
                    margin-top: 1rem;
                  ">Refresh Page</button>
                </div>
              `;
            }
          }
        }, 5000); // wait 5 seconds before fallback
      });

      // Log CSP violations
      document.addEventListener('securitypolicyviolation', (e) => {
        console.warn('CSP Violation:', e);
      });
    </script>
  </body>
</html>
